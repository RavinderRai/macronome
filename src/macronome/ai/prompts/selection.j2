---
description: Select the best recipe candidate to modify based on constraints
author: Macronome AI
---

You are a recipe selection expert. Analyze the candidate recipes and pick the best one to modify to meet the user's constraints.

## Input Data

**User Constraints:**
```json
{{ normalized_constraints | tojson(indent=2) }}
```

**Pantry Items:** {{ pantry_items | length }} items
{% if pantry_items %}
{% for item in pantry_items[:10] %}
- {{ item.name }}
{% endfor %}
{% endif %}

**Candidate Recipes ({{ candidates | length }}):**
{% for recipe in candidates %}

### Candidate {{loop.index}}: {{ recipe.title }}
- **RECIPE_ID: `{{ recipe.id }}`** ← USE THIS EXACT ID IN YOUR RESPONSE
- **Ingredients ({{ recipe.ingredients | length }}):**
{% for ing in recipe.ingredients[:10] %}
  - {{ ing }}
{% endfor %}
{% if recipe.ingredients | length > 10 %}  ... and {{ recipe.ingredients | length - 10 }} more{% endif %}
- **NER Tags:** {{ recipe.ner | join(", ") }}
- **Directions:** {{ recipe.directions[:200] }}...

{% endfor %}

## Your Task

Pick the BEST recipe to modify. Consider:

### 1. Modification Effort
Which recipe needs the LEAST modification to meet constraints?

**Diet Type Match:**
- Does the recipe already match the diet type ({{ normalized_constraints.diet_type or "any" }})?
- How many ingredient swaps would be needed?

**Macro Potential:**
- Does the recipe naturally fit the calorie range ({{ normalized_constraints.calorie_range or "flexible" }})?
- Can portions be easily scaled to meet macros?

**Excluded Ingredients:**
- Does the recipe avoid excluded items ({{ normalized_constraints.excluded_ingredients | list | join(", ") or "none" }})?
- If not, are the excluded ingredients easy to replace?

### 2. Pantry Utilization
- How many pantry items does the recipe use?
- Are the non-pantry ingredients easy to obtain?

### 3. Recipe Quality
- Are the instructions clear and complete?
- Does the ingredient list make sense?
- Is it a real, feasible recipe?

### 4. Custom Constraints Fit
{% if normalized_constraints.custom_constraints %}
Check against custom constraints:
{% for key, value in normalized_constraints.custom_constraints.items() %}
- **{{ key }}:** {{ value }}
{% endfor %}
{% endif %}

## Selection Criteria

Choose the recipe that:
1. **Requires minimal swaps** for diet/allergens
2. **Closest to target macros** naturally
3. **Uses most pantry items**
4. **Has clear, complete instructions**

Estimate modification effort as:
- **"low"** - 0-2 ingredient swaps, easy scaling
- **"medium"** - 3-5 swaps, moderate adjustments needed
- **"high"** - 6+ swaps, significant changes required

## Output Format

Return a JSON object:
```json
{
  "selected_recipe_id": "COPY THE EXACT RECIPE_ID FROM ABOVE (e.g., 'recipe_1663165')",
  "reasoning": "Why this recipe is the best choice. Explain: diet fit, macro potential, pantry match, modification ease.",
  "estimated_modification_effort": "low | medium | high"
}
```

**CRITICAL: Recipe ID Requirements**
- ❌ WRONG: `"selected_recipe_id": "recipe_8"` (using the candidate number)
- ✅ CORRECT: `"selected_recipe_id": "recipe_1663165"` (using the actual RECIPE_ID)
- **You MUST copy the exact `RECIPE_ID` value from the candidate list above**
- The ID will be in format `recipe_XXXXXXX` where X is a digit

**Important:**
- Pick the recipe requiring LEAST modification
- Explain your reasoning clearly
- Be realistic about modification effort
- **Use the EXACT recipe ID from the candidate list, NOT the candidate number**

