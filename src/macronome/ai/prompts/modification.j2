---
description: Modify recipe to meet all user constraints (simplified)
author: Macronome AI
---

Modify this recipe to meet ALL user constraints, or leave it as is if it already meets constraints.

## Current Recipe
**Title:** {{ recipe_title }}

**Ingredients:**
{{ current_ingredients_str }}

**Directions:**
{{ directions }}

## Current Nutrition
{{ nutrition_feedback }}

## Target Constraints
{% for constraint in constraints_summary %}
• {{ constraint }}
{% endfor %}

## Pantry Items Available
{% if pantry_items %}
{% for item in pantry_items %}
• {{ item }}
{% endfor %}
{% else %}
• None
{% endif %}

## {{ issues_feedback }}
{% if specific_suggestions %}

## Specific Suggestions
{{ specific_suggestions }}
{% endif %}

## Your Task (Iteration {{ iteration }}/{{ max_iterations }})
Output a COMPLETE modified recipe that meets ALL constraints:

1. **Use pantry items** when possible (preferred but not required)
2. **Meet calorie range** exactly
3. **Meet macro targets** (protein, carbs, fat)
4. **Respect diet type** ({{ diet_type or "none" }})
5. **Avoid excluded ingredients** ({{ excluded_ingredients_str }})

**Important:**
- Output the COMPLETE recipe with ALL ingredients in structured format
- Each ingredient must have: quantity (float), unit (string), ingredient (string)
- Be precise with quantities to hit targets
- If recipe is 3x too large (e.g., 2000 cal target 600), scale everything by ~0.3x
- Document what you changed and why in the modifications list
